---
title: Storage Encryption

oep-number: 6

creation-date: 2023-01-03

status: implementable

authors:
- "@Ashughorla"
- "@kasabe28"
- "@ushabelgur"
  
reviewers:
- "@ManuStoessel"
- "@adracus"
- "@afritzler"

---

# OEP-6: Storage Encryption

## Table of Contents

- [Summary](#summary)
- [Motivation](#motivation)
    - [Goals](#goals)
    - [Details](#Details)
- [Proposal](#proposal)

## Summary
One of the important feature of Cloud Native IaS is to provide secure storage. This functionality is built on top of Ceph-CSI supported individual RBD PersistentVolumeClaim encryption, more information can be found here https://rook.io/docs/rook/v1.9/ceph-csi-drivers.html#enable-rbd-encryption-support. This proposal focuses on providing option to enable encryption for individual onmetal Volume.

## Motivation
As part of Storage encryption feature Onmetal API to support option to enable encryption of Volumes. Each `Volume` can set encryption enabled flag. Each `VolumePool` can provide secret reference holding encryption secret(Optional).

### Goals
  - `Volume` should provide encryption enabled flag
  - `VolumePool` should add field to provide secret reference

### Details
  - By default encryption enabled flag will be set to false
  - `VolumePool` should add optional field to provide autogenerated secret reference to encrypt onmetal `Volume`. Onmetal-api will only add field to be used by cephlet and don't provide secret reference. This secret reference will be given by cephlet while reconsiling `VolumePool`.

## Proposal
The proposal to provide storage encryption introduces new field `encryption` in existing `Volume` type and `encryption.secretRef.name` in existing `VolumePool` type. `encryption` is boolean field indicating whether encryption to be enabled or not for the `Volume`. `encryption.secretRef.name` is an optional field for secret reference.

Volume with encryption enabled flag:

[//]: # (@formatter:off)
```yaml
apiVersion: storage.api.onmetal.de/v1alpha1
kind: Volume
metadata:
  name: sample-volume
  namespace: default
spec:
  volumeClassRef:
    name: fast
  volumePoolRef:
    name: ceph
  resources:
    storage: 1Gi
  encryption: true
```
[//]: # (@formatter:on)

VolumePool with optional encryption secret field:

[//]: # (@formatter:off)
```yaml
apiVersion: storage.api.onmetal.de/v1alpha1
kind: VolumePool
metadata:
  name: volumepool-sample
spec:
  providerID: onmetal://shared
  # optional field to provide encryption secret
  encryption:
    secretRef:
      name:
```
[//]: # (@formatter:on)